<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Research and commentary from Barkertons on commercial real estate markets, land development strategy and land value and overseas opportunities including Brazil and New Zealand.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Insights | Barkertons Property</title>
  
  <!-- GOOGLE FONTS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;500;600&family=Inknut+Antiqua:wght@400;600&display=swap" rel="stylesheet">

  <!-- MAIN SITE CSS -->
  <link rel="stylesheet" href="../assets/css/styles.css">

  <!-- INSIGHTS PAGE CSS -->
  <link rel="stylesheet" href="insights.css">
</head>

  <script src="../assets/js/main.js" defer></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  fetch('JS/insights-data.json')
    .then(res => res.json())
    .then(data => {
      const track = document.querySelector('.home-carousel .carousel-track');
      if (!track) return;

      data.forEach(item => {
        const card = document.createElement('div');
        card.className = 'project-box'; // matches main.js carousel code
        card.innerHTML = `
          <a href="${item.link}">
            <img src="${item.image}" alt="${item.title}">
            <h3>${item.title}</h3>
            <p>${item.summary}</p>
            <p class="card-date">${item.date}</p>
          </a>
        `;
        track.appendChild(card);
      });
    })
    .catch(err => console.error('Failed to load Insights JSON:', err));
});
</script>

<body>

<div id="header" style="height:90px;"></div>

<main class="insights-page">
  <h1 class="insights-title">Our Insights</h1>

  <!-- Carousel / summary cards container -->
  <section class="home-carousel">
    <div class="carousel-wrapper">
      <button class="carousel-arrow left">&#8249;</button>

      <div class="carousel-track">
        <!-- Cards are dynamically added here by JS -->
      </div>

      <button class="carousel-arrow right">&#8250;</button>
    </div>
  </section>
</main>

<div id="footer"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // Load header and footer
  function loadHTML(id, file) {
    fetch(file)
      .then(res => res.text())
      .then(data => document.getElementById(id).innerHTML = data)
      .catch(err => console.error(`Failed to load ${file}:`, err));
  }
  loadHTML('header', '../header.html');
  loadHTML('footer', '../footer.html');

  // Load Insights JSON and build cards
  fetch('JS/insights-data.json')
    .then(res => res.json())
    .then(data => {
      const track = document.querySelector('.home-carousel .carousel-track');
      if (!track) return;

      data.forEach(item => {
        const card = document.createElement('div');
        card.className = 'project-box';
        card.innerHTML = `
          <a href="${item.link}">
            <img src="${item.image}" alt="${item.title}">
            <h3>${item.title}</h3>
            <p>${item.summary}</p>
            <p class="date">${item.date}</p>
          </a>
        `;
        track.appendChild(card);
      });

      // Arrow scroll functionality
      const leftArrow = document.querySelector('.carousel-arrow.left');
      const rightArrow = document.querySelector('.carousel-arrow.right');
      const wrapper = document.querySelector('.carousel-wrapper');

      if (!leftArrow || !rightArrow || !wrapper) return;

      let currentTranslate = 0;
      const gap = parseInt(getComputedStyle(track).gap) || 30;

      function getItemWidth() {
        const first = track.querySelector('.project-box');
        return first ? first.offsetWidth : 300;
      }

      function updateTranslate() {
        const maxScroll = Math.max(track.scrollWidth - wrapper.clientWidth, 0);
        currentTranslate = Math.min(0, Math.max(currentTranslate, -maxScroll));
        track.style.transform = `translateX(${currentTranslate}px)`;
      }

      leftArrow.addEventListener('click', () => {
        currentTranslate += getItemWidth() + gap;
        updateTranslate();
      });

      rightArrow.addEventListener('click', () => {
        currentTranslate -= getItemWidth() + gap;
        updateTranslate();
      });

      // Drag to scroll
      let dragging = false, startX = 0, prevTranslate = 0;

      track.addEventListener('mousedown', e => {
        dragging = true;
        startX = e.pageX;
        prevTranslate = currentTranslate;
      });

      window.addEventListener('mouseup', () => dragging = false);

      window.addEventListener('mousemove', e => {
        if (!dragging) return;
        currentTranslate = prevTranslate + (e.pageX - startX);
        updateTranslate();
      });

      window.addEventListener('resize', updateTranslate);

      updateTranslate();
    })
    .catch(err => console.error('Failed to load Insights JSON:', err));
});
